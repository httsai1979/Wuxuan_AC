# 武軒冷氣／水電預約 Web App (v4.0)

本專案為武軒企業社專用的冷氣預約與工單管理系統。v4.0 版本已全面增強估價邏輯、UI 體驗與師傅端功能。

## ✨ v4.0 新增功能
- **💰 精準估價引擎**:
  - **區域加價**: 依據鄉鎮 (Zone A/B/C/D) 自動計算出車費。
  - **管線超長**: 超過標準 4 米自動加收材料費。
  - **特殊加給**: 夜間施工、沿海防蝕、危險施工、無 220V 電源等自動判讀。
  - **旺季加價**: 7-9 月自動觸發旺季費率。
  - **稅額計算**: 支援 5% 營業稅外加/內含切換。

- **📱 優化使用者體驗**:
  - **Sticky Footer**: 底部固定顯示即時估價區間，隨時掌握預算。
  - **詳細明細 (Breakdown)**: 結帳頁面列出所有加價項目與原因。
  - **徽章系統 (Badges)**: 清楚標示費用來源 (如 `TRAVEL`, `PIPE`, `COAST`)。
  - **Info Cards**: 點擊 `i` 按鈕可查看圖文並茂的說明 (如 220V 插座樣式、管線長度估算)。

- **🛠️ 師傅端 (Installer Portal)**:
  - **追加單 (Change Order)**: 現場可新增追加項目，即時更新工單總價。
  - **電子簽名**: 完工時客戶直接在手機上簽名。
  - **自動保固書**: 完工確認後，系統自動生成含簽名的保固書 PDF 並歸檔。
  - **一鍵導航/撥號**: 整合 Google Maps 與電話功能。

## 🚀 快速啟動

請參考 [部署指南 (deployment_guide.md)](c:\Users\James Tsai\.gemini\antigravity\brain\e6f2b782-60b2-4eeb-a61e-e2678291226f\deployment_guide.md) 進行安裝。

### 簡易預覽
1. 進入專案目錄：
   ```bash
   cd /workspace/Wuxuan_AC/wuxuan-hvac-web
   ```
2. 啟動伺服器：
   ```bash
   python -m http.server 8080
   ```
3. 瀏覽器開啟：
   - 客戶端: [http://127.0.0.1:8080](http://127.0.0.1:8080)
   - 師傅端: [http://127.0.0.1:8080/installer.html](http://127.0.0.1:8080/installer.html) (通行碼: 8888)

## 📂 檔案結構
- `index.html`: 客戶預約主介面 (Wizard Flow)。
- `installer.html`: 師傅工單管理介面。
- `app.js`: 核心邏輯 (估價、表單、API)。
- `server/Code.js`: Google Apps Script 後端程式碼。

## ⚙️ 系統設定 (Google Sheets)
系統初始化後，會自動建立以下工作表：
1. **訂單管理**: 儲存所有訂單狀態、連結與 PDF。
2. **報價規則**: 可調整各項服務的基礎價格與加價費率。

> **注意**: 前端 `app.js` 內含部分即時估價邏輯，若大幅修改計價方式，需同步更新前端程式碼與後端 Sheet 設定。


### 保固卡（Warranty）
1. **抬頭**：武軒企業社冷氣安裝保固卡 + Logo/聯絡方式。
2. **工程資訊**：屋主姓名、電話、地址、完工日期、保固起迄、品牌/型號/室內機位置。
3. **保固範圍**：施工瑕疵（配管滲漏、固定不牢等）保固年限與處理方式。
4. **不在保固內**：天災（地震、颱風、鹽害）、外力撞擊、非獨立回路、排水遭破壞等。
5. **償件原則**：上限＝本次工程金額，需提供照片/報告/材料紀錄。
6. **處理流程與聯絡方式**，並附上 i-warranty、i-220v、i-drain、i-coast 索引。

## Google Calendar 事件規範
- **事件標題**：`[安裝/移機/維修] 屋主姓名 - 品牌/噸數 - 區域（例：吉安）`。
- **描述（多行 key:value）**：
  - 客戶姓名 / 聯絡電話 / 施工地址
  - 樓層 / 電梯
  - 服務類型、品牌/型號/噸數、室內機數量與位置
  - 牆體材質、室外機位置、估計管線長度
  - 排水方式（自然 / 加壓排水器建議）
  - 沿海防蝕建議（是/否）
  - 照片連結（指向 Drive photos 資料夾）
  - 工單編號

## SLA 條款（FAQ 與網站共用）
- 回覆時效：一般狀況 48 小時內以電話或訊息回覆屋主。
- 到場時效：一般狀況 3 個工作天內安排到府；重大天災或全區停電會另行公告。
- 緊急狀況優先：若冷媒大量外洩、室內明顯漏水、用電異常等，將優先排程並主動通知。

## UAT Checklist（Google Sheet 可直接貼上）
| 編號 | 測試場景 | 步驟簡述 | 預期結果 | 是否通過 | 備註 |
| --- | --- | --- | --- | --- | --- |
| 1 | 花蓮市 3 樓有電梯夜間安裝 | 線上預約 + 看估價 + 成功頁 | 出現 OFFHOUR 徽章；TRAVEL = 0；可下載報價單 |  |  |
| 2 | 壽豐沿海 5 樓無電梯 | 預約 + 上傳照片 + 選白天 | 出現 TRAVEL + COAST 徽章；提示沿海防蝕建議 |  |  |
| 3 | 鳳林長距離 + 管線 8 米 | 預約 + 寫 8 米 | PIPE 超長 4 米被計價；TRAVEL 顯示 Zone C |  |  |
| 4 | 現場變更（需加壓排水器） | 師傅端開變更單 + 屋主簽名 | 變更單列出項目與理由；屋主能看到簽名與總價更新 |  |  |
| 5 | 完工後寄送報告與保固卡 | 師傅完成 SOP 打卡並送出完工 | 屋主收到含完工報告 + 保固卡 PDF 的 Email |  |  |
| 6 | 屋主「我的工單」重看資料 | 屋主用電話+工單ID登入 | 能看到估價明細、變更紀錄、照片清單、報價單與保固下載 |  |  |
